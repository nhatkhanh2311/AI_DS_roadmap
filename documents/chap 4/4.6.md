# Giai Ä‘oáº¡n 4: Nháº­p mÃ´n Há»c MÃ¡y vÃ  cÃ¡c NguyÃªn lÃ½ Cá»‘t lÃµi
## BÃ i 4.6: Huáº¥n luyá»‡n & ÄÃ¡nh giÃ¡ MÃ´ hÃ¬nh Há»“i quy

### **ğŸ¯ Má»¥c tiÃªu bÃ i há»c:**
1.  Hiá»ƒu sá»± khÃ¡c biá»‡t giá»¯a viá»‡c Ä‘Ã¡nh giÃ¡ mÃ´ hÃ¬nh phÃ¢n loáº¡i vÃ  mÃ´ hÃ¬nh há»“i quy.
2.  Náº¯m vá»¯ng cÃ¡c chá»‰ sá»‘ Ä‘Ã¡nh giÃ¡ cá»‘t lÃµi cho bÃ i toÃ¡n há»“i quy: **MAE, MSE, RMSE, vÃ  R-squared ($R^2$)**.
3.  Biáº¿t cÃ¡ch diá»…n giáº£i vÃ  lá»±a chá»n chá»‰ sá»‘ phÃ¹ há»£p cho tá»«ng tÃ¬nh huá»‘ng.

---

### **Bá»‘i cáº£nh & Táº§m quan trá»ng**

Trong bÃ i toÃ¡n phÃ¢n loáº¡i, cÃ¢u tráº£ lá»i thÆ°á»ng lÃ  "Ä‘Ãºng" hoáº·c "sai". NhÆ°ng vá»›i há»“i quy, cÃ¢u tráº£ lá»i lÃ  má»™t con sá»‘, vÃ  chÃºng ta cáº§n biáº¿t: "dá»± Ä‘oÃ¡n cá»§a tÃ´i **sai lá»‡ch bao nhiÃªu** so vá»›i thá»±c táº¿?".

VÃ­ dá»¥, khi dá»± Ä‘oÃ¡n giÃ¡ nhÃ :
* MÃ´ hÃ¬nh A dá»± Ä‘oÃ¡n sai 100 triá»‡u.
* MÃ´ hÃ¬nh B dá»± Ä‘oÃ¡n sai 500 triá»‡u.

RÃµ rÃ ng mÃ´ hÃ¬nh A tá»‘t hÆ¡n, nhÆ°ng chÃºng ta cáº§n nhá»¯ng chá»‰ sá»‘ Ä‘Æ°á»£c chuáº©n hÃ³a Ä‘á»ƒ Ä‘o lÆ°á»ng vÃ  so sÃ¡nh hiá»‡u nÄƒng má»™t cÃ¡ch khÃ¡ch quan. Viá»‡c lá»±a chá»n chá»‰ sá»‘ nÃ o Ä‘á»ƒ tá»‘i Æ°u cÅ©ng ráº¥t quan trá»ng, vÃ¬ má»—i chá»‰ sá»‘ sáº½ "trá»«ng pháº¡t" cÃ¡c loáº¡i lá»—i khÃ¡c nhau.

---

### **LÃ½ thuyáº¿t Cá»‘t lÃµi & Ná»n táº£ng ToÃ¡n há»c**

Giáº£ sá»­:
* $y_i$: lÃ  giÃ¡ trá»‹ thá»±c táº¿ cá»§a Ä‘iá»ƒm dá»¯ liá»‡u thá»© $i$.
* $\hat{y}_i$ (y-hat): lÃ  giÃ¡ trá»‹ dá»± Ä‘oÃ¡n cá»§a mÃ´ hÃ¬nh cho Ä‘iá»ƒm dá»¯ liá»‡u thá»© $i$.
* $m$: lÃ  tá»•ng sá»‘ Ä‘iá»ƒm dá»¯ liá»‡u.

#### **1. Mean Absolute Error (MAE) - Sai sá»‘ Tuyá»‡t Ä‘á»‘i Trung bÃ¬nh**
* **CÃ´ng thá»©c:**
    $$ \text{MAE} = \frac{1}{m} \sum_{i=1}^{m} |y_i - \hat{y}_i| $$
* **Diá»…n giáº£i:** LÃ  giÃ¡ trá»‹ **trung bÃ¬nh cá»§a khoáº£ng cÃ¡ch tuyá»‡t Ä‘á»‘i** giá»¯a giÃ¡ trá»‹ dá»± Ä‘oÃ¡n vÃ  giÃ¡ trá»‹ thá»±c táº¿.
* **Äáº·c tÃ­nh:** Ráº¥t dá»… hiá»ƒu vÃ¬ nÃ³ cÃ³ cÃ¹ng Ä‘Æ¡n vá»‹ vá»›i giÃ¡ trá»‹ cáº§n dá»± Ä‘oÃ¡n. VÃ­ dá»¥, MAE lÃ  150 triá»‡u cÃ³ nghÄ©a lÃ , trung bÃ¬nh, mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n sai lá»‡ch 150 triá»‡u. NÃ³ khÃ´ng "trá»«ng pháº¡t" cÃ¡c lá»—i lá»›n má»™t cÃ¡ch Ä‘áº·c biá»‡t.

#### **2. Mean Squared Error (MSE) - Sai sá»‘ BÃ¬nh phÆ°Æ¡ng Trung bÃ¬nh**
* **CÃ´ng thá»©c:**
    $$ \text{MSE} = \frac{1}{m} \sum_{i=1}^{m} (y_i - \hat{y}_i)^2 $$
* **Diá»…n giáº£i:** LÃ  giÃ¡ trá»‹ **trung bÃ¬nh cá»§a bÃ¬nh phÆ°Æ¡ng sai sá»‘**.
* **Äáº·c tÃ­nh:** VÃ¬ cÃ¡c sai sá»‘ Ä‘Æ°á»£c bÃ¬nh phÆ°Æ¡ng lÃªn, MSE **"trá»«ng pháº¡t" cÃ¡c lá»—i lá»›n náº·ng hÆ¡n ráº¥t nhiá»u** so vá»›i cÃ¡c lá»—i nhá». Má»™t láº§n dá»± Ä‘oÃ¡n sai 1 tá»· sáº½ áº£nh hÆ°á»Ÿng Ä‘áº¿n MSE nhiá»u hÆ¡n ráº¥t nhiá»u so vá»›i 10 láº§n dá»± Ä‘oÃ¡n sai 100 triá»‡u. NhÆ°á»£c Ä‘iá»ƒm cá»§a nÃ³ lÃ  Ä‘Æ¡n vá»‹ bá»‹ bÃ¬nh phÆ°Æ¡ng lÃªn (vÃ­ dá»¥: `(triá»‡u Ä‘á»“ng)^2`), nÃªn khÃ³ diá»…n giáº£i.

#### **3. Root Mean Squared Error (RMSE) - CÄƒn Báº­c hai cá»§a Sai sá»‘ BÃ¬nh phÆ°Æ¡ng Trung bÃ¬nh**
* **CÃ´ng thá»©c:**
    $$ \text{RMSE} = \sqrt{\text{MSE}} = \sqrt{\frac{1}{m} \sum_{i=1}^{m} (y_i - \hat{y}_i)^2} $$
* **Diá»…n giáº£i:** ÄÆ¡n giáº£n lÃ  cÄƒn báº­c hai cá»§a MSE.
* **Äáº·c tÃ­nh:** NÃ³ vá»«a **trá»«ng pháº¡t cÃ¡c lá»—i lá»›n** (do cÃ³ bÃ¬nh phÆ°Æ¡ng bÃªn trong), vá»«a cÃ³ **cÃ¹ng Ä‘Æ¡n vá»‹** vá»›i giÃ¡ trá»‹ dá»± Ä‘oÃ¡n, lÃ m cho nÃ³ trá»Ÿ thÃ nh má»™t trong nhá»¯ng chá»‰ sá»‘ phá»• biáº¿n nháº¥t Ä‘á»ƒ bÃ¡o cÃ¡o hiá»‡u nÄƒng cá»§a mÃ´ hÃ¬nh há»“i quy.

#### **4. R-squared ($R^2$) - Há»‡ sá»‘ XÃ¡c Ä‘á»‹nh**
* **Ã tÆ°á»Ÿng:** Thay vÃ¬ Ä‘o sai sá»‘ tuyá»‡t Ä‘á»‘i, $R^2$ Ä‘o lÆ°á»ng **mÃ´ hÃ¬nh cá»§a báº¡n tá»‘t hÆ¡n bao nhiÃªu so vá»›i má»™t mÃ´ hÃ¬nh ngÃ¢y thÆ¡** chá»‰ luÃ´n dá»± Ä‘oÃ¡n giÃ¡ trá»‹ trung bÃ¬nh.
* **CÃ´ng thá»©c:**
    $$ R^2 = 1 - \frac{\sum (y_i - \hat{y}_i)^2}{\sum (y_i - \bar{y})^2} = 1 - \frac{\text{MSE}}{\text{PhÆ°Æ¡ng sai cá»§a y}} $$
    * $\bar{y}$ (y-bar) lÃ  giÃ¡ trá»‹ trung bÃ¬nh cá»§a táº¥t cáº£ cÃ¡c giÃ¡ trá»‹ thá»±c táº¿ $y_i$.
* **Diá»…n giáº£i:** $R^2$ lÃ  má»™t giÃ¡ trá»‹ tá»« $(-\infty, 1]$. NÃ³ cho biáº¿t **bao nhiÃªu pháº§n trÄƒm sá»± biáº¿n thiÃªn cá»§a dá»¯ liá»‡u Ä‘Æ°á»£c mÃ´ hÃ¬nh giáº£i thÃ­ch**.
    * $R^2 = 1$: MÃ´ hÃ¬nh hoÃ n háº£o, giáº£i thÃ­ch Ä‘Æ°á»£c 100% sá»± biáº¿n thiÃªn.
    * $R^2 = 0$: MÃ´ hÃ¬nh khÃ´ng tá»‘t hÆ¡n viá»‡c chá»‰ Ä‘oÃ¡n bá»«a báº±ng giÃ¡ trá»‹ trung bÃ¬nh.
    * $R^2 = 0.75$: MÃ´ hÃ¬nh giáº£i thÃ­ch Ä‘Æ°á»£c 75% sá»± biáº¿n thiÃªn cá»§a dá»¯ liá»‡u.
    * $R^2 < 0$: MÃ´ hÃ¬nh cÃ²n tá»‡ hÆ¡n cáº£ viá»‡c Ä‘oÃ¡n bá»«a.

---

### **Triá»ƒn khai & PhÃ¢n tÃ­ch Code**

ChÃºng ta sáº½ sá»­ dá»¥ng bá»™ dá»¯ liá»‡u kinh Ä‘iá»ƒn `Boston Housing` Ä‘á»ƒ dá»± Ä‘oÃ¡n giÃ¡ nhÃ .

    import pandas as pd
    from sklearn.model_selection import train_test_split
    from sklearn.linear_model import LinearRegression
    from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
    import numpy as np

    # Táº£i bá»™ dá»¯ liá»‡u Boston housing
    # LÆ°u Ã½: Bá»™ dá»¯ liá»‡u nÃ y Ä‘Æ°á»£c tÃ­ch há»£p sáºµn trong cÃ¡c phiÃªn báº£n scikit-learn cÅ©.
    # Vá»›i cÃ¡c phiÃªn báº£n má»›i, ta nÃªn táº£i tá»« nguá»“n khÃ¡c.
    # Äoáº¡n code sau dÃ¹ng link tá»« github cá»§a scikit-learn Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh á»•n Ä‘á»‹nh.
    data_url = "http://lib.stat.cmu.edu/datasets/boston"
    raw_df = pd.read_csv(data_url, sep="\s+", skiprows=22, header=None)
    data = np.hstack([raw_df.values[::2, :], raw_df.values[1::2, :2]])
    target = raw_df.values[1::2, 2]
    # Chuyá»ƒn thÃ nh DataFrame
    X = pd.DataFrame(data)
    y = pd.Series(target)
    
    # Chia dá»¯ liá»‡u
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    
    # Huáº¥n luyá»‡n mÃ´ hÃ¬nh Há»“i quy Tuyáº¿n tÃ­nh
    model = LinearRegression()
    model.fit(X_train, y_train)
    
    # ÄÆ°a ra dá»± Ä‘oÃ¡n
    y_pred = model.predict(X_test)
    
    # TÃ­nh toÃ¡n cÃ¡c chá»‰ sá»‘
    mae = mean_absolute_error(y_test, y_pred)
    mse = mean_squared_error(y_test, y_pred)
    rmse = np.sqrt(mse)
    r2 = r2_score(y_test, y_pred)

    print("--- Káº¿t quáº£ ÄÃ¡nh giÃ¡ MÃ´ hÃ¬nh Há»“i quy ---")
    print(f"Mean Absolute Error (MAE): {mae:.4f}")
    print(f"Mean Squared Error (MSE): {mse:.4f}")
    print(f"Root Mean Squared Error (RMSE): {rmse:.4f}")
    print(f"R-squared (R2): {r2:.4f}")

---

### **âœï¸ BÃ i thá»±c hÃ nh:**

Sá»­ dá»¥ng cÃ¹ng bá»™ dá»¯ liá»‡u `Boston Housing` Ä‘Ã£ Ä‘Æ°á»£c chia á»Ÿ trÃªn (`X_train`, `X_test`, `y_train`, `y_test`).

1.  **Huáº¥n luyá»‡n má»™t mÃ´ hÃ¬nh khÃ¡c:**
    * Import `RandomForestRegressor` tá»« `sklearn.ensemble`.
    * Khá»Ÿi táº¡o vÃ  huáº¥n luyá»‡n má»™t mÃ´ hÃ¬nh Random Forest trÃªn cÃ¹ng bá»™ dá»¯ liá»‡u huáº¥n luyá»‡n.
    * ÄÆ°a ra dá»± Ä‘oÃ¡n trÃªn táº­p test.

2.  **ÄÃ¡nh giÃ¡ vÃ  So sÃ¡nh:**
    * TÃ­nh toÃ¡n táº¥t cáº£ 4 chá»‰ sá»‘ (MAE, MSE, RMSE, $R^2$) cho mÃ´ hÃ¬nh `RandomForestRegressor`.
    * Dá»±a trÃªn cÃ¡c chá»‰ sá»‘ Ä‘Ã³, so sÃ¡nh hiá»‡u nÄƒng cá»§a `RandomForestRegressor` vá»›i `LinearRegression`. MÃ´ hÃ¬nh nÃ o hoáº¡t Ä‘á»™ng tá»‘t hÆ¡n? Táº¡i sao? (Gá»£i Ã½: MAE/MSE/RMSE cÃ ng tháº¥p cÃ ng tá»‘t, $R^2$ cÃ ng cao cÃ ng tá»‘t).