# Giai Ä‘oáº¡n 4: Nháº­p mÃ´n Há»c MÃ¡y vÃ  cÃ¡c NguyÃªn lÃ½ Cá»‘t lÃµi
## BÃ i 4.4: CÃ¡c Ká»¹ thuáº­t XÃ¢y dá»±ng vÃ  Lá»±a chá»n Äáº·c trÆ°ng

### **ğŸ¯ Má»¥c tiÃªu bÃ i há»c:**
1.  Hiá»ƒu tÆ° duy cá»‘t lÃµi cá»§a Feature Engineering: táº¡o ra cÃ¡c tÃ­n hiá»‡u tá»‘t hÆ¡n cho mÃ´ hÃ¬nh.
2.  Há»c cÃ¡c ká»¹ thuáº­t phá»• biáº¿n Ä‘á»ƒ **táº¡o (create)** vÃ  **biáº¿n Ä‘á»•i (transform)** Ä‘áº·c trÆ°ng.
3.  LÃ m quen vá»›i khÃ¡i niá»‡m **lá»±a chá»n Ä‘áº·c trÆ°ng (feature selection)**.

---

### **Bá»‘i cáº£nh & Táº§m quan trá»ng**

Náº¿u dá»¯ liá»‡u lÃ  nguyÃªn liá»‡u thÃ´, thÃ¬ cÃ¡c Ä‘áº·c trÆ°ng (features) lÃ  nhá»¯ng thÃ nh pháº§n Ä‘Ã£ Ä‘Æ°á»£c sÆ¡ cháº¿ Ä‘á»ƒ náº¥u má»™t mÃ³n Äƒn. **Cháº¥t lÆ°á»£ng cá»§a cÃ¡c Ä‘áº·c trÆ°ng quyáº¿t Ä‘á»‹nh giá»›i háº¡n hiá»‡u nÄƒng cao nháº¥t mÃ  má»™t mÃ´ hÃ¬nh cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c.** Má»™t mÃ´ hÃ¬nh Ä‘Æ¡n giáº£n vá»›i cÃ¡c Ä‘áº·c trÆ°ng tá»‘t cÃ³ thá»ƒ dá»… dÃ ng Ä‘Ã¡nh báº¡i má»™t mÃ´ hÃ¬nh phá»©c táº¡p vá»›i cÃ¡c Ä‘áº·c trÆ°ng tá»“i.

ÄÃ¢y lÃ  cÃ´ng viá»‡c Ä‘Ã²i há»i sá»± sÃ¡ng táº¡o, kiáº¿n thá»©c chuyÃªn ngÃ nh (domain knowledge) vÃ  sá»± tháº¥u hiá»ƒu dá»¯ liá»‡u. BÃ i há»c nÃ y sáº½ trang bá»‹ cho báº¡n cÃ¡c ká»¹ thuáº­t phá»• biáº¿n Ä‘á»ƒ báº¯t Ä‘áº§u.

---

### **LÃ½ thuyáº¿t Cá»‘t lÃµi & Ká»¹ thuáº­t**

Feature Engineering cÃ³ thá»ƒ Ä‘Æ°á»£c chia thÃ nh 3 nhÃ¡nh chÃ­nh:

#### **1. Táº¡o Äáº·c trÆ°ng má»›i (Feature Creation)**
ÄÃ¢y lÃ  quÃ¡ trÃ¬nh táº¡o ra cÃ¡c Ä‘áº·c trÆ°ng má»›i tá»« nhá»¯ng Ä‘áº·c trÆ°ng Ä‘Ã£ cÃ³.

* **Káº¿t há»£p Äáº·c trÆ°ng:**
    * VÃ­ dá»¥: Táº¡o `FamilySize` tá»« `SibSp` vÃ  `Parch` nhÆ° chÃºng ta Ä‘Ã£ lÃ m.
    * VÃ­ dá»¥ khÃ¡c: Trong má»™t bá»™ dá»¯ liá»‡u nhÃ  Ä‘áº¥t, báº¡n cÃ³ thá»ƒ táº¡o Ä‘áº·c trÆ°ng `PricePerSqMeter` (giÃ¡ má»—i mÃ©t vuÃ´ng) báº±ng cÃ¡ch láº¥y `Price` chia cho `Area`. Äáº·c trÆ°ng má»›i nÃ y cÃ³ thá»ƒ chá»©a nhiá»u thÃ´ng tin hÆ¡n hai Ä‘áº·c trÆ°ng gá»‘c.

* **Äáº·c trÆ°ng Äa thá»©c (Polynomial Features):**
    * **Váº¥n Ä‘á»:** CÃ¡c mÃ´ hÃ¬nh tuyáº¿n tÃ­nh (sáº½ há»c á»Ÿ Giai Ä‘oáº¡n 5) chá»‰ cÃ³ thá»ƒ há»c Ä‘Æ°á»£c cÃ¡c má»‘i quan há»‡ Ä‘Æ°á»ng tháº³ng.
    * **Giáº£i phÃ¡p:** Táº¡o ra cÃ¡c Ä‘áº·c trÆ°ng báº­c cao ($x^2, x^3, x_1 \cdot x_2$, v.v.). Äiá»u nÃ y cho phÃ©p mÃ´ hÃ¬nh tuyáº¿n tÃ­nh há»c Ä‘Æ°á»£c cÃ¡c Ä‘Æ°á»ng cong phá»©c táº¡p.
    
            from sklearn.preprocessing import PolynomialFeatures
            import numpy as np
            
            X = np.array([[2], [3], [4]])
            poly = PolynomialFeatures(degree=2)
            X_poly = poly.fit_transform(X)
            # X_poly sáº½ lÃ : [[1., 2., 4.], [1., 3., 9.], [1., 4., 16.]]
            # Cá»™t má»›i x^2 Ä‘Ã£ Ä‘Æ°á»£c táº¡o ra.

#### **2. Biáº¿n Ä‘á»•i Äáº·c trÆ°ng (Feature Transformation)**
ÄÃ¢y lÃ  quÃ¡ trÃ¬nh biáº¿n Ä‘á»•i má»™t Ä‘áº·c trÆ°ng hiá»‡n cÃ³ Ä‘á»ƒ lÃ m cho nÃ³ há»¯u Ã­ch hÆ¡n cho mÃ´ hÃ¬nh.

* **Rá»i ráº¡c hÃ³a / Chia giá» (Binning/Discretization):**
    * **Ã tÆ°á»Ÿng:** Chuyá»ƒn má»™t biáº¿n liÃªn tá»¥c (nhÆ° `Tuá»•i`) thÃ nh má»™t biáº¿n háº¡ng má»¥c.
    * **Táº¡i sao?** ÄÃ´i khi, má»‘i quan há»‡ khÃ´ng pháº£i lÃ  tuyáº¿n tÃ­nh. VÃ­ dá»¥, giÃ¡ vÃ© mÃ¡y bay cÃ³ thá»ƒ cao cho tráº» sÆ¡ sinh (<2 tuá»•i), ráº» cho tráº» em, vÃ  láº¡i cao cho ngÆ°á»i lá»›n. Viá»‡c chia `Tuá»•i` thÃ nh cÃ¡c nhÃ³m 'SÆ¡ sinh', 'Tráº» em', 'NgÆ°á»i lá»›n' cÃ³ thá»ƒ giÃºp mÃ´ hÃ¬nh náº¯m báº¯t Ä‘Æ°á»£c quy luáº­t nÃ y tá»‘t hÆ¡n.

            # VÃ­ dá»¥ chia Tuá»•i thÃ nh 3 nhÃ³m báº±ng Pandas
            # pd.cut(df['Age'], bins=[0, 18, 60, 100], labels=['Tráº» em', 'NgÆ°á»i lá»›n', 'NgÆ°á»i cao tuá»•i'])

* **Biáº¿n Ä‘á»•i Logarit (Log Transform):**
    * **Ã tÆ°á»Ÿng:** Ãp dá»¥ng phÃ©p tÃ­nh logarit (`np.log`) cho má»™t Ä‘áº·c trÆ°ng.
    * **Khi nÃ o dÃ¹ng?** Ráº¥t há»¯u Ã­ch khi báº¡n cÃ³ má»™t Ä‘áº·c trÆ°ng bá»‹ lá»‡ch pháº£i ráº¥t máº¡nh (nhÆ° cá»™t `Fare` trong dá»¯ liá»‡u Titanic). Biáº¿n Ä‘á»•i log sáº½ giÃºp "nÃ©n" cÃ¡c giÃ¡ trá»‹ lá»›n láº¡i gáº§n nhau hÆ¡n, lÃ m cho phÃ¢n phá»‘i cá»§a nÃ³ gáº§n vá»›i phÃ¢n phá»‘i chuáº©n hÆ¡n, Ä‘iá»u nÃ y thÆ°á»ng giÃºp cÃ¡c mÃ´ hÃ¬nh tuyáº¿n tÃ­nh hoáº¡t Ä‘á»™ng tá»‘t hÆ¡n.

#### **3. Lá»±a chá»n Äáº·c trÆ°ng (Feature Selection)**
* **Váº¥n Ä‘á»:** Sau khi táº¡o ra ráº¥t nhiá»u Ä‘áº·c trÆ°ng, khÃ´ng pháº£i Ä‘áº·c trÆ°ng nÃ o cÅ©ng há»¯u Ã­ch. Má»™t sá»‘ cÃ³ thá»ƒ gÃ¢y nhiá»…u, má»™t sá»‘ cÃ³ thá»ƒ bá»‹ thá»«a (tÆ°Æ¡ng quan cao vá»›i nhau). Viá»‡c cÃ³ quÃ¡ nhiá»u Ä‘áº·c trÆ°ng cÅ©ng lÃ m mÃ´ hÃ¬nh cháº­m hÆ¡n vÃ  dá»… bá»‹ overfitting.
* **Má»¥c tiÃªu:** Chá»n ra má»™t táº­p há»£p con cÃ¡c Ä‘áº·c trÆ°ng quan trá»ng nháº¥t Ä‘á»ƒ Ä‘Æ°a vÃ o mÃ´ hÃ¬nh.
* **CÃ¡c phÆ°Æ¡ng phÃ¡p (Giá»›i thiá»‡u):**
    * **Filter Methods:** DÃ¹ng cÃ¡c bÃ i kiá»ƒm tra thá»‘ng kÃª (nhÆ° há»‡ sá»‘ tÆ°Æ¡ng quan) Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ vÃ  lá»c cÃ¡c Ä‘áº·c trÆ°ng trÆ°á»›c khi huáº¥n luyá»‡n mÃ´ hÃ¬nh.
    * **Wrapper Methods:** Sá»­ dá»¥ng chÃ­nh mÃ´ hÃ¬nh há»c mÃ¡y Ä‘á»ƒ "thá»­" cÃ¡c táº­p con Ä‘áº·c trÆ°ng khÃ¡c nhau vÃ  chá»n ra táº­p con cho káº¿t quáº£ tá»‘t nháº¥t.
    * **Embedded Methods:** CÃ¡c mÃ´ hÃ¬nh tá»± cÃ³ kháº£ nÄƒng lá»±a chá»n Ä‘áº·c trÆ°ng trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n (vÃ­ dá»¥: Lasso Regression).

---

### **Triá»ƒn khai & PhÃ¢n tÃ­ch Code**

ChÃºng ta sáº½ thá»±c hÃ nh má»™t vÃ i ká»¹ thuáº­t trÃªn bá»™ dá»¯ liá»‡u Titanic.

    import pandas as pd
    import numpy as np
    
    df = pd.read_csv('titanic.csv')
    df['Age'].fillna(df['Age'].median(), inplace=True)

    # 1. Táº¡o Ä‘áº·c trÆ°ng 'FamilySize'
    df['FamilySize'] = df['SibSp'] + df['Parch'] + 1

    # 2. Táº¡o Ä‘áº·c trÆ°ng 'IsAlone'
    df['IsAlone'] = 0
    df.loc[df['FamilySize'] == 1, 'IsAlone'] = 1

    # 3. Biáº¿n Ä‘á»•i Logarit cho cá»™t 'Fare'
    # ThÃªm 1 Ä‘á»ƒ trÃ¡nh log(0)
    df['Fare_log'] = np.log(df['Fare'] + 1)
    
    # 4. Rá»i ráº¡c hÃ³a cho cá»™t 'Age'
    df['Age_bin'] = pd.cut(df['Age'], bins=[0, 12, 18, 60, 100], labels=['Tráº» em', 'Thiáº¿u niÃªn', 'NgÆ°á»i lá»›n', 'NgÆ°á»i cao tuá»•i'])
    
    print("DataFrame vá»›i cÃ¡c Ä‘áº·c trÆ°ng má»›i:")
    print(df[['FamilySize', 'IsAlone', 'Fare_log', 'Age_bin']].head())

---

### **PhÃ¢n tÃ­ch ChuyÃªn sÃ¢u**

* **Nghá»‡ thuáº­t vs. Khoa há»c:** Feature Engineering vá»«a lÃ  nghá»‡ thuáº­t (Ä‘Ã²i há»i sá»± sÃ¡ng táº¡o vÃ  kiáº¿n thá»©c chuyÃªn ngÃ nh) vá»«a lÃ  khoa há»c (Ä‘Ã²i há»i viá»‡c thá»­ nghiá»‡m vÃ  Ä‘Ã¡nh giÃ¡ má»™t cÃ¡ch cÃ³ há»‡ thá»‘ng).
* **KhÃ´ng cÃ³ cÃ´ng thá»©c chung:** Ká»¹ thuáº­t hiá»‡u quáº£ trÃªn bá»™ dá»¯ liá»‡u nÃ y cÃ³ thá»ƒ khÃ´ng hiá»‡u quáº£ trÃªn bá»™ dá»¯ liá»‡u khÃ¡c. ÄÃ¢y lÃ  má»™t quÃ¡ trÃ¬nh láº·p Ä‘i láº·p láº¡i: táº¡o Ä‘áº·c trÆ°ng -> huáº¥n luyá»‡n mÃ´ hÃ¬nh -> Ä‘Ã¡nh giÃ¡ -> quay láº¡i táº¡o Ä‘áº·c trÆ°ng má»›i.
* **Nguy cÆ¡ RÃ² rá»‰ Dá»¯ liá»‡u:** Khi táº¡o Ä‘áº·c trÆ°ng, hÃ£y cáº©n tháº­n khÃ´ng sá»­ dá»¥ng thÃ´ng tin tá»« táº­p test. VÃ­ dá»¥, khi báº¡n chuáº©n hÃ³a má»™t Ä‘áº·c trÆ°ng má»›i, báº¡n pháº£i há»c `mean` vÃ  `std` tá»« táº­p train vÃ  Ã¡p dá»¥ng nÃ³ cho táº­p test.

---

### **âœï¸ BÃ i thá»±c hÃ nh:**

1.  **Táº¡o Äáº·c trÆ°ng TÆ°Æ¡ng tÃ¡c:**
    * Trong bá»™ dá»¯ liá»‡u Titanic, cÃ³ thá»ƒ Ä‘áº·c trÆ°ng `Pclass` vÃ  `Age` tÆ°Æ¡ng tÃ¡c vá»›i nhau (vÃ­ dá»¥: tuá»•i trung bÃ¬nh cá»§a háº¡ng 1 khÃ¡c háº¡ng 3). Má»™t cÃ¡ch Ä‘á»ƒ náº¯m báº¯t sá»± tÆ°Æ¡ng tÃ¡c nÃ y lÃ  táº¡o má»™t Ä‘áº·c trÆ°ng má»›i báº±ng cÃ¡ch nhÃ¢n chÃºng vá»›i nhau.
    * HÃ£y táº¡o má»™t cá»™t má»›i tÃªn lÃ  `Age_Pclass` báº±ng giÃ¡ trá»‹ cá»§a cá»™t `Age` nhÃ¢n vá»›i cá»™t `Pclass`. Quan sÃ¡t 5 dÃ²ng Ä‘áº§u tiÃªn cá»§a Ä‘áº·c trÆ°ng má»›i nÃ y.

2.  **PhÃ¢n tÃ­ch Äáº·c trÆ°ng má»›i `Title`:**
    * Sá»­ dá»¥ng láº¡i hÃ m `extract_title` tá»« bÃ i thá»±c hÃ nh trÆ°á»›c Ä‘á»ƒ táº¡o ra cá»™t `Title`.
    * Má»™t sá»‘ chá»©c danh ráº¥t hiáº¿m (nhÆ° 'Don', 'Ms', 'Lady'). HÃ£y viáº¿t code Ä‘á»ƒ nhÃ³m táº¥t cáº£ cÃ¡c chá»©c danh khÃ´ng pháº£i lÃ  'Mr', 'Miss', 'Mrs', 'Master' vÃ o má»™t nhÃ³m chung gá»i lÃ  'Other'.
    * **Gá»£i Ã½:** DÃ¹ng `.value_counts()` Ä‘á»ƒ xem cÃ¡c chá»©c danh. Táº¡o má»™t danh sÃ¡ch cÃ¡c chá»©c danh phá»• biáº¿n. DÃ¹ng hÃ m `.apply()` vá»›i má»™t biá»ƒu thá»©c `lambda` Ä‘á»ƒ thay tháº¿.